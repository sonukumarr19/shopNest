<!-- product-list.component.html -->
<div class="min-h-screen bg-gray-50">

  <div class="max-w-full mx-auto px-4 py-6">
    <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
      
      <!-- Filters Sidebar -->
      <div class="lg:col-span-1">
        <div class="bg-white rounded-lg shadow-md sticky top-6">
          <!-- Filter Header -->
          <div class="flex justify-between items-center p-4 border-b border-gray-200">
            <h2 class="font-semibold text-lg text-gray-800">Filters</h2>
            <button 
              (click)="clearFilters()"
              class="text-blue-600 hover:text-blue-800 font-medium text-sm"
            >
              Clear All
            </button>
          </div>

          <!-- Categories -->
          <div class="p-4 border-b border-gray-200">
            <h3 class="font-medium text-gray-800 mb-3">Categories</h3>
            <div class="space-y-2">
              <label 
                *ngFor="let category of availableCategories"
                class="flex items-center cursor-pointer hover:bg-gray-50 p-1 rounded"
              >
                <input 
                    type="checkbox" 
                    [checked]="filters.categoryIds.includes(category._id!)"
                    (change)="onCategoryChange(category._id!, $event)"
                    class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                >
                <span class="ml-3 text-gray-700">{{category.name }}</span>
              </label>
            </div>
          </div>

          <!-- Brands -->
          <div class="p-4 border-b border-gray-200">
            <h3 class="font-medium text-gray-800 mb-3">Brands</h3>
            <div class="space-y-2">
              <label 
                *ngFor="let brand of visibleBrands" 
                class="flex items-center cursor-pointer hover:bg-gray-50 p-1 rounded"
              >
                <input 
                  type="checkbox" 
                  (change)="onBrandChange(brand._id!, $event)"
                  [checked]="filters.brandIds.includes(brand._id!)"
                  class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                >
                <span class="ml-3 text-gray-700">{{brand.name}}</span>
              </label>
              <button 
                *ngIf="availableBrands.length > 6" 
                (click)="showAllBrands = !showAllBrands"
                class="text-blue-600 hover:text-blue-800 font-medium text-sm mt-2"
                >
                {{ showAllBrands ? 'Show Less' : 'See All' }}
                </button>
            </div>
          </div>

          <!-- Price Range -->
          <div class="p-4 border-b border-gray-200">
            <h3 class="font-medium text-gray-800 mb-3">Price Range</h3>
            <div class="space-y-3">
              <div class="flex space-x-2">
                <input 
                  type="number" 
                  [(ngModel)]="filters.priceRange.min"
                  (input)="onPriceRangeChange()"
                  placeholder="Min"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                >
                <input 
                  type="number" 
                  [(ngModel)]="filters.priceRange.max"
                  (input)="onPriceRangeChange()"
                  placeholder="Max"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                >
              </div>
            </div>
          </div>

          <!-- Availability -->
          <div class="p-4">
            <h3 class="font-medium text-gray-800 mb-3">Availability</h3>
            <label class="flex items-center cursor-pointer hover:bg-gray-50 p-1 rounded">
              <input 
                type="checkbox" 
                (change)="onStockChange($event)"
                [checked]="filters.inStock"
                class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
              >
              <span class="ml-3 text-gray-700">In Stock Only</span>
            </label>
          </div>
        </div>
      </div>

      <!-- Products Section -->
      <div class="lg:col-span-3">
        <!-- Sort and Results Header -->
        <div class="bg-white rounded-lg shadow-md p-4 mb-6">
          <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-3 sm:space-y-0">
            <div class="flex items-center space-x-4">
              <h2 class="text-lg font-semibold text-gray-800">
                Products <span class="text-gray-500">({{filteredProducts.length}} items)</span>
              </h2>
              <!-- Show category mix indicator when multiple categories are selected -->
              <div *ngIf="filters.categoryIds.length > 1" class="flex items-center space-x-2">
                <span class="bg-green-100 text-green-800 text-xs font-medium px-2 py-1 rounded-full">
                  Mixed Categories
                </span>
                <button 
                  (click)="reshuffleProducts()"
                  class="text-blue-600 hover:text-blue-800 text-sm font-medium flex items-center space-x-1"
                  title="Reshuffle products order"
                >
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                  </svg>
                  <span>Reshuffle</span>
                </button>
              </div>
            </div>
            <div class="flex items-center space-x-2">
              <label class="text-gray-700 font-medium">Sort by:</label>
              <select 
                [(ngModel)]="sortBy" 
                (change)="onSortChange()"
                class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
              >
                <option value="popularity">Popularity</option>
                <option value="price-low">Price: Low to High</option>
                <option value="price-high">Price: High to Low</option>
                <option value="discount">Discount</option>
                <option value="random">Random Order</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Products Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6" *ngIf="filteredProducts.length > 0">
          <div 
            *ngFor="let product of filteredProducts; trackBy: trackByProductId" 
            class="bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300 overflow-hidden group"
          >
            <!-- Product Image -->
            <div class="relative overflow-hidden">
              <a [routerLink]="['/product', product._id]">
                <img 
                  [src]="product.images[0]" 
                  [alt]="product.name"
                  class="w-full h-80 object-contain group-hover:scale-105 transition-transform duration-300"
                >
              </a>
              <div 
                *ngIf="product.discount > 0" 
                class="absolute top-2 left-2 bg-green-500 text-white px-2 py-1 rounded text-sm font-medium"
              >
                {{product.discount}}% OFF
              </div>
              <div 
                *ngIf="!product.inStock" 
                class="absolute top-2 right-2 bg-red-500 text-white px-2 py-1 rounded text-sm font-medium"
              >
                Out of Stock
              </div>
              <!-- Category indicator for mixed category view -->
              <div 
                *ngIf="filters.categoryIds.length > 1" 
                class="absolute bottom-2 left-2 bg-blue-500 bg-opacity-90 text-white px-2 py-1 rounded text-xs font-medium"
              >
                {{product.categoryName}}
              </div>
            </div>

            <!-- Product Details -->
            <div class="p-4 relative">
              <h3 class="font-medium text-gray-800 mb-2 line-clamp-2 group-hover:text-blue-600 transition-colors">
                {{product.name}}
              </h3>
              
              <!-- Features -->
              <div class="flex flex-wrap gap-1 mb-3">
                <span 
                  *ngFor="let feature of product.shortDescription.split(',')" 
                  class="bg-gray-100 text-gray-600 px-2 py-1 rounded text-xs"
                >
                  {{feature}}
                </span>
              </div>

              <!-- Price -->
              <div class="flex items-center space-x-2 mb-4">
                <span class="text-2xl font-bold text-gray-900">â‚¹{{ (product.price - product.discount * product.price / 100) | number : '1.0-0' }}</span>
                <span 
                  *ngIf="product.price > product.price * (1 - product.discount)" 
                  class="text-gray-500 line-through text-lg"
                >
                  {{formatPrice(product.price)}}
                </span>
              </div>

              <!-- Add to Cart Button -->
              <button 
                [disabled]="!product.inStock"
                class="w-full py-2 px-4 rounded-md font-medium transition-colors duration-200"
                [class]="product.inStock 
                  ? 'bg-blue-600 hover:bg-blue-700 text-white' 
                  : 'bg-gray-300 text-gray-500 cursor-not-allowed'"
              >
                {{product.inStock ? 'Add to Cart' : 'Out of Stock'}}
              </button>
            </div>
          </div>
        </div>

        <!-- No Products Found -->
        <div 
          *ngIf="filteredProducts.length === 0" 
          class="text-center py-12 bg-white rounded-lg shadow-md"
        >
          <div class="text-6xl text-gray-300 mb-4">ðŸ“¦</div>
          <h3 class="text-xl font-medium text-gray-600 mb-2">No products found</h3>
          <p class="text-gray-500">Try adjusting your filters or search terms</p>
          <button 
            (click)="clearFilters()"
            class="mt-4 bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-md font-medium transition-colors duration-200"
          >
            Clear Filters
          </button>
        </div>
      </div>
    </div>
  </div>
</div>